libquadmath_dep = cc.find_library('quadmath', required: false)


prima_f = static_library('prima_f',
  dependencies: [libquadmath_dep],
  fortran_args : [
    '-DPRIMA_REAL_PRECISION=64',
    '-DPRIMA_INTEGER_KIND=0',
  ],
  sources:[
    '../../_lib/prima/fortran/common/linalg.f90',
    '../../_lib/prima/fortran/common/pintrf.f90',
    '../../_lib/prima/fortran/common/string.f90',
    '../../_lib/prima/fortran/common/evaluate.f90',
    '../../_lib/prima/fortran/common/preproc.f90',
    '../../_lib/prima/fortran/common/univar.f90',
    '../../_lib/prima/fortran/common/powalg.f90',
    '../../_lib/prima/fortran/common/history.f90',
    '../../_lib/prima/fortran/common/xinbd.f90',
    '../../_lib/prima/fortran/common/message.f90',
    '../../_lib/prima/fortran/common/fprint.f90',
    '../../_lib/prima/fortran/common/ratio.f90',
    '../../_lib/prima/fortran/common/debug.F90',
    '../../_lib/prima/fortran/common/consts.F90',
    '../../_lib/prima/fortran/common/checkexit.f90',
    '../../_lib/prima/fortran/common/inf.F90',
    '../../_lib/prima/fortran/common/redrho.f90',
    '../../_lib/prima/fortran/common/memory.F90',
    '../../_lib/prima/fortran/common/selectx.f90',
    '../../_lib/prima/fortran/common/huge.F90',
    '../../_lib/prima/fortran/common/infnan.F90',
    '../../_lib/prima/fortran/common/shiftbase.f90',
    '../../_lib/prima/fortran/common/infos.f90',
    '../../_lib/prima/fortran/cobyla/cobyla.f90',
    '../../_lib/prima/fortran/cobyla/cobylb.f90',
    '../../_lib/prima/fortran/cobyla/geometry.f90',
    '../../_lib/prima/fortran/cobyla/initialize.f90',
    '../../_lib/prima/fortran/cobyla/trustregion.f90',
    '../../_lib/prima/fortran/cobyla/update.f90',
    '../../_lib/prima/fortran/bobyqa/bobyqa.f90',
    '../../_lib/prima/fortran/bobyqa/bobyqb.f90',
    '../../_lib/prima/fortran/bobyqa/geometry.f90',
    '../../_lib/prima/fortran/bobyqa/initialize.f90',
    '../../_lib/prima/fortran/bobyqa/trustregion.f90',
    '../../_lib/prima/fortran/bobyqa/rescue.f90',
    '../../_lib/prima/fortran/bobyqa/update.f90',
    '../../_lib/prima/fortran/lincoa/update.f90',
    '../../_lib/prima/fortran/lincoa/initialize.f90',
    '../../_lib/prima/fortran/lincoa/getact.f90',
    '../../_lib/prima/fortran/lincoa/trustregion.f90',
    '../../_lib/prima/fortran/lincoa/geometry.f90',
    '../../_lib/prima/fortran/lincoa/lincob.f90',
    '../../_lib/prima/fortran/lincoa/lincoa.f90',
    '../../_lib/prima/fortran/newuoa/initialize.f90',
    '../../_lib/prima/fortran/newuoa/trustregion.f90',
    '../../_lib/prima/fortran/newuoa/geometry.f90',
    '../../_lib/prima/fortran/newuoa/update.f90',
    '../../_lib/prima/fortran/newuoa/newuob.f90',
    '../../_lib/prima/fortran/newuoa/newuoa.f90',
    '../../_lib/prima/fortran/uobyqa/initialize.f90',
    '../../_lib/prima/fortran/uobyqa/update.f90',
    '../../_lib/prima/fortran/uobyqa/geometry.f90',
    '../../_lib/prima/fortran/uobyqa/trustregion.f90',
    '../../_lib/prima/fortran/uobyqa/uobyqb.f90',
    '../../_lib/prima/fortran/uobyqa/uobyqa.f90',
  ]
)


prima_f_c = static_library('prima_f_c',
  c_args: [
    '-DPRIMAC_STATIC',
    '-DPRIMA_REAL_PRECISION=64',
    '-DPRIMA_INTEGER_KIND=0',
  ],
  include_directories: [ '../../_lib/prima/c/include', ],
  link_language: 'fortran',
  link_with: prima_f,
  sources: [
    '../../_lib/prima/c/cintrf.f90',
    '../../_lib/prima/c/cobyla_c.f90',
    '../../_lib/prima/c/lincoa_c.f90',
    '../../_lib/prima/c/bobyqa_c.f90',
    '../../_lib/prima/c/newuoa_c.f90',
    '../../_lib/prima/c/uobyqa_c.f90',
    '../../_lib/prima/c/prima.c'
  ],
)


_prima_wrapper = py3.extension_module('_prima',
  cpp_args: ['-DPRIMAC_STATIC'],
  dependencies: [pybind11_dep],
  include_directories: [ '../../_lib/prima/c/include'],
  install: true,
  link_args: version_link_args,
  link_with: [prima_f_c],
  sources: [ '../../_lib/prima/python/_prima.cpp'],
  subdir: 'scipy/optimize/_prima'
)
