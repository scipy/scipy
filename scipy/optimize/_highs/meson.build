highs_define_macros = [
  '-DCMAKE_BUILD_TYPE="RELEASE"',
  '-DFAST_BUILD=ON',
  '-DHIGHS_GITHASH="n/a"',
  '-DHIGHS_COMPILATION_DATE="0000-00-00"',  # cannot generate dynamically
  '-DHIGHS_VERSION_MAJOR=1',  # don't care about this, look at Version.txt
  '-DHIGHS_VERSION_MINOR=5',
  '-DHIGHS_VERSION_PATCH=3',
  '-DHIGHS_DIR=' + meson.current_source_dir() / '..' / '..' / '_lib' / 'highs',
  '-UOPENMP',
  '-UEXT_PRESOLVE',
  '-USCIP_DEV',
  '-UHiGHSDEV',
  '-UOSI_FOUND',
  '-DNDEBUG'
]

highs_flags = [
  _cpp_Wno_class_memaccess,
  _cpp_Wno_format_truncation,
  _cpp_Wno_non_virtual_dtor,
  _cpp_Wno_sign_compare,
  _cpp_Wno_switch,
  _cpp_Wno_unused_but_set_variable,
  _cpp_Wno_unused_variable,
  Wno_unused_variable,
]

basiclu_sources = [
    '../../_lib/highs/src/ipm/basiclu/basiclu_factorize.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_solve_dense.c',
    '../../_lib/highs/src/ipm/basiclu/lu_build_factors.c',
    '../../_lib/highs/src/ipm/basiclu/lu_factorize_bump.c',
    '../../_lib/highs/src/ipm/basiclu/lu_initialize.c',
    '../../_lib/highs/src/ipm/basiclu/lu_markowitz.c',
    '../../_lib/highs/src/ipm/basiclu/lu_setup_bump.c',
    '../../_lib/highs/src/ipm/basiclu/lu_solve_sparse.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_get_factors.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_solve_for_update.c',
    '../../_lib/highs/src/ipm/basiclu/lu_condest.c',
    '../../_lib/highs/src/ipm/basiclu/lu_file.c',
    '../../_lib/highs/src/ipm/basiclu/lu_internal.c',
    '../../_lib/highs/src/ipm/basiclu/lu_matrix_norm.c',
    '../../_lib/highs/src/ipm/basiclu/lu_singletons.c',
    '../../_lib/highs/src/ipm/basiclu/lu_solve_symbolic.c',
    '../../_lib/highs/src/ipm/basiclu/lu_update.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_initialize.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_solve_sparse.c',
    '../../_lib/highs/src/ipm/basiclu/lu_pivot.c',
    '../../_lib/highs/src/ipm/basiclu/lu_solve_dense.c',
    '../../_lib/highs/src/ipm/basiclu/lu_solve_triangular.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_object.c',
    '../../_lib/highs/src/ipm/basiclu/basiclu_update.c',
    '../../_lib/highs/src/ipm/basiclu/lu_dfs.c',
    '../../_lib/highs/src/ipm/basiclu/lu_garbage_perm.c',
    '../../_lib/highs/src/ipm/basiclu/lu_residual_test.c',
    '../../_lib/highs/src/ipm/basiclu/lu_solve_for_update.c'
]

ipx_sources = [
    '../../_lib/highs/src/ipm/ipx/basiclu_kernel.cc',
    '../../_lib/highs/src/ipm/ipx/basiclu_wrapper.cc',
    '../../_lib/highs/src/ipm/ipx/basis.cc',
    '../../_lib/highs/src/ipm/ipx/conjugate_residuals.cc',
    '../../_lib/highs/src/ipm/ipx/control.cc',
    '../../_lib/highs/src/ipm/ipx/crossover.cc',
    '../../_lib/highs/src/ipm/ipx/diagonal_precond.cc',
    '../../_lib/highs/src/ipm/ipx/forrest_tomlin.cc',
    '../../_lib/highs/src/ipm/ipx/guess_basis.cc',
    '../../_lib/highs/src/ipm/ipx/indexed_vector.cc',
    '../../_lib/highs/src/ipm/ipx/info.cc',
    '../../_lib/highs/src/ipm/ipx/ipm.cc',
    '../../_lib/highs/src/ipm/ipx/ipx_c.cc',
    '../../_lib/highs/src/ipm/ipx/iterate.cc',
    '../../_lib/highs/src/ipm/ipx/kkt_solver.cc',
    '../../_lib/highs/src/ipm/ipx/kkt_solver_basis.cc',
    '../../_lib/highs/src/ipm/ipx/kkt_solver_diag.cc',
    '../../_lib/highs/src/ipm/ipx/linear_operator.cc',
    '../../_lib/highs/src/ipm/ipx/lp_solver.cc',
    '../../_lib/highs/src/ipm/ipx/lu_factorization.cc',
    '../../_lib/highs/src/ipm/ipx/lu_update.cc',
    '../../_lib/highs/src/ipm/ipx/maxvolume.cc',
    '../../_lib/highs/src/ipm/ipx/model.cc',
    '../../_lib/highs/src/ipm/ipx/normal_matrix.cc',
    '../../_lib/highs/src/ipm/ipx/sparse_matrix.cc',
    '../../_lib/highs/src/ipm/ipx/sparse_utils.cc',
    '../../_lib/highs/src/ipm/ipx/splitted_normal_matrix.cc',
    '../../_lib/highs/src/ipm/ipx/starting_basis.cc',
    '../../_lib/highs/src/ipm/ipx/symbolic_invert.cc',
    '../../_lib/highs/src/ipm/ipx/timer.cc',
    '../../_lib/highs/src/ipm/ipx/utils.cc'
]

highs_lib = static_library('highs',
  [
    '../../_lib/highs/extern/filereaderlp/reader.cpp',
    '../../_lib/highs/src/io/Filereader.cpp',
    '../../_lib/highs/src/io/FilereaderLp.cpp',
    '../../_lib/highs/src/io/FilereaderEms.cpp',
    '../../_lib/highs/src/io/FilereaderMps.cpp',
    '../../_lib/highs/src/io/HighsIO.cpp',
    '../../_lib/highs/src/io/HMPSIO.cpp',
    '../../_lib/highs/src/io/HMpsFF.cpp',
    '../../_lib/highs/src/io/LoadOptions.cpp',
    '../../_lib/highs/src/lp_data/Highs.cpp',
    '../../_lib/highs/src/lp_data/HighsDebug.cpp',
    '../../_lib/highs/src/lp_data/HighsDeprecated.cpp',
    '../../_lib/highs/src/lp_data/HighsInfo.cpp',
    '../../_lib/highs/src/lp_data/HighsInfoDebug.cpp',
    '../../_lib/highs/src/lp_data/HighsInterface.cpp',
    '../../_lib/highs/src/lp_data/HighsLp.cpp',
    '../../_lib/highs/src/lp_data/HighsLpUtils.cpp',
    '../../_lib/highs/src/lp_data/HighsModelUtils.cpp',
    '../../_lib/highs/src/lp_data/HighsRanging.cpp',
    '../../_lib/highs/src/lp_data/HighsSolution.cpp',
    '../../_lib/highs/src/lp_data/HighsSolutionDebug.cpp',
    '../../_lib/highs/src/lp_data/HighsSolve.cpp',
    '../../_lib/highs/src/lp_data/HighsStatus.cpp',
    '../../_lib/highs/src/lp_data/HighsOptions.cpp',
    '../../_lib/highs/src/presolve/ICrash.cpp',
    '../../_lib/highs/src/presolve/ICrashUtil.cpp',
    '../../_lib/highs/src/presolve/ICrashX.cpp',
    '../../_lib/highs/src/mip/HighsMipSolver.cpp',
    '../../_lib/highs/src/mip/HighsMipSolverData.cpp',
    '../../_lib/highs/src/mip/HighsDomain.cpp',
    '../../_lib/highs/src/mip/HighsDynamicRowMatrix.cpp',
    '../../_lib/highs/src/mip/HighsLpRelaxation.cpp',
    '../../_lib/highs/src/mip/HighsSeparation.cpp',
    '../../_lib/highs/src/mip/HighsSeparator.cpp',
    '../../_lib/highs/src/mip/HighsTableauSeparator.cpp',
    '../../_lib/highs/src/mip/HighsModkSeparator.cpp',
    '../../_lib/highs/src/mip/HighsPathSeparator.cpp',
    '../../_lib/highs/src/mip/HighsCutGeneration.cpp',
    '../../_lib/highs/src/mip/HighsSearch.cpp',
    '../../_lib/highs/src/mip/HighsConflictPool.cpp',
    '../../_lib/highs/src/mip/HighsCutPool.cpp',
    '../../_lib/highs/src/mip/HighsCliqueTable.cpp',
    '../../_lib/highs/src/mip/HighsGFkSolve.cpp',
    '../../_lib/highs/src/mip/HighsTransformedLp.cpp',
    '../../_lib/highs/src/mip/HighsLpAggregator.cpp',
    '../../_lib/highs/src/mip/HighsDebugSol.cpp',
    '../../_lib/highs/src/mip/HighsImplications.cpp',
    '../../_lib/highs/src/mip/HighsPrimalHeuristics.cpp',
    '../../_lib/highs/src/mip/HighsPseudocost.cpp',
    '../../_lib/highs/src/mip/HighsNodeQueue.cpp',
    '../../_lib/highs/src/mip/HighsObjectiveFunction.cpp',
    '../../_lib/highs/src/mip/HighsRedcostFixing.cpp',
    '../../_lib/highs/src/model/HighsHessian.cpp',
    '../../_lib/highs/src/model/HighsHessianUtils.cpp',
    '../../_lib/highs/src/model/HighsModel.cpp',
    '../../_lib/highs/src/parallel/HighsTaskExecutor.cpp',
    '../../_lib/highs/src/presolve/HighsPostsolveStack.cpp',
    '../../_lib/highs/src/presolve/HighsSymmetry.cpp',
    '../../_lib/highs/src/presolve/HPresolve.cpp',
    '../../_lib/highs/src/presolve/HPresolveAnalysis.cpp',
    '../../_lib/highs/src/presolve/PresolveComponent.cpp',
    '../../_lib/highs/src/qpsolver/basis.cpp',
    '../../_lib/highs/src/qpsolver/quass.cpp',
    '../../_lib/highs/src/qpsolver/ratiotest.cpp',
    '../../_lib/highs/src/qpsolver/scaling.cpp',
    '../../_lib/highs/src/qpsolver/perturbation.cpp',
    '../../_lib/highs/src/simplex/HEkk.cpp',
    '../../_lib/highs/src/simplex/HEkkControl.cpp',
    '../../_lib/highs/src/simplex/HEkkDebug.cpp',
    '../../_lib/highs/src/simplex/HEkkPrimal.cpp',
    '../../_lib/highs/src/simplex/HEkkDual.cpp',
    '../../_lib/highs/src/simplex/HEkkDualRHS.cpp',
    '../../_lib/highs/src/simplex/HEkkDualRow.cpp',
    '../../_lib/highs/src/simplex/HEkkDualMulti.cpp',
    '../../_lib/highs/src/simplex/HEkkInterface.cpp',
    '../../_lib/highs/src/simplex/HighsSimplexAnalysis.cpp',
    '../../_lib/highs/src/simplex/HSimplex.cpp',
    '../../_lib/highs/src/simplex/HSimplexDebug.cpp',
    '../../_lib/highs/src/simplex/HSimplexNla.cpp',
    '../../_lib/highs/src/simplex/HSimplexNlaDebug.cpp',
    '../../_lib/highs/src/simplex/HSimplexNlaFreeze.cpp',
    '../../_lib/highs/src/simplex/HSimplexNlaProductForm.cpp',
    '../../_lib/highs/src/simplex/HSimplexReport.cpp',
    '../../_lib/highs/src/test/KktCh2.cpp',
    '../../_lib/highs/src/test/DevKkt.cpp',
    '../../_lib/highs/src/util/HFactor.cpp',
    '../../_lib/highs/src/util/HFactorDebug.cpp',
    '../../_lib/highs/src/util/HFactorExtend.cpp',
    '../../_lib/highs/src/util/HFactorRefactor.cpp',
    '../../_lib/highs/src/util/HFactorUtils.cpp',
    '../../_lib/highs/src/util/HighsHash.cpp',
    '../../_lib/highs/src/util/HighsLinearSumBounds.cpp',
    '../../_lib/highs/src/util/HighsMatrixPic.cpp',
    '../../_lib/highs/src/util/HighsMatrixUtils.cpp',
    '../../_lib/highs/src/util/HighsSort.cpp',
    '../../_lib/highs/src/util/HighsSparseMatrix.cpp',
    '../../_lib/highs/src/util/HighsUtils.cpp',
    '../../_lib/highs/src/util/HSet.cpp',
    '../../_lib/highs/src/util/HVectorBase.cpp',
    '../../_lib/highs/src/util/stringutil.cpp',
    '../../_lib/highs/src/interfaces/highs_c_api.cpp',
    '../../_lib/highs/src/ipm/IpxWrapper.cpp'
  ] + basiclu_sources + ipx_sources,
  include_directories: [
    'src/',
    '../../_lib/highs/extern/',
    '../../_lib/highs/src/',
    '../../_lib/highs/src/io/',
    '../../_lib/highs/src/ipm/ipx/',
    '../../_lib/highs/src/lp_data/',
    '../../_lib/highs/src/util/',
  ],
  dependencies: thread_dep,
  cpp_args: [highs_flags, highs_define_macros]
)

highs_bindings = py3.extension_module('highs_bindings',
  ['../../_lib/highs/highspy/highs_bindings.cpp'],
  cpp_args: [highs_flags, highs_define_macros, numpy_nodepr_api],
  include_directories: [
    'src',
    '../../_lib/highs/src/',
  ],
  dependencies: [np_dep, pybind11_dep],
  link_args: version_link_args,
  link_with: [highs_lib],
  install: true,
  subdir: 'scipy/optimize/_highs'
)

_highs_options = py3.extension_module('_highs_options',
  ['_highs_options.cpp'],
  cpp_args: [highs_flags, highs_define_macros],
  link_with: [highs_lib],
  include_directories: [
    'src',
    '../../_lib/highs/src/',
    '../../_lib/highs/src/lp_data/'
  ],
  install: true,
  subdir: 'scipy/optimize/_highs'
)

_highs_constants = py3.extension_module('_highs_constants',
  ['_highs_constants.cpp'],
  cpp_args: [highs_flags, highs_define_macros],
  link_with: [highs_lib],
  include_directories: [
    'src',
    '../../_lib/highs/src/',
    '../../_lib/highs/src/lp_data/',
    '../../_lib/highs/src/simplex/'
  ],
  install: true,
  subdir: 'scipy/optimize/_highs'
)

py3.install_sources([
    '__init__.py',
    '_highs_wrapper.py'
  ],
  subdir: 'scipy/optimize/_highs'
)
